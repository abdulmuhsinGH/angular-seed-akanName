var path = require('path');
var expect = require('expect.js');
var fs = require('fs');

var helpers = require('../helpers');
var bower = helpers.require('lib/index');

describe('bower uninstall', function () {

<<<<<<< HEAD
    var tempDir = helpers.createTmpDir({
=======
    var tempDir = new helpers.TempDir({
>>>>>>> 15ba42d088e9a77be8036efbc2189d0ea4c8dfc3
        'bower.json': {
            name: 'hello-world',
            dependencies: {
                'underscore': '*'
            }
        }
    });

<<<<<<< HEAD
    var bowerJsonPath = path.join(tempDir, 'bower.json');
=======
    beforeEach(function() {
        tempDir.prepare();
    });

    var bowerJsonPath = path.join(tempDir.path, 'bower.json');
>>>>>>> 15ba42d088e9a77be8036efbc2189d0ea4c8dfc3

    function bowerJson() {
        return JSON.parse(fs.readFileSync(bowerJsonPath));
    }

    var config = {
<<<<<<< HEAD
        cwd: tempDir,
=======
        cwd: tempDir.path,
>>>>>>> 15ba42d088e9a77be8036efbc2189d0ea4c8dfc3
        interactive: true
    };

    it('does not remove anything from dependencies by default', function () {
        var logger = bower.commands.uninstall(['underscore'], undefined, config);

        return helpers.expectEvent(logger, 'end')
        .then(function () {
            expect(bowerJson().dependencies).to.eql({ 'underscore': '*' });
        });
    });

    it('removes dependency from bower.json if --save flag is used', function () {
        var logger = bower.commands.uninstall(['underscore'], {save: true}, config);

        return helpers.expectEvent(logger, 'end')
        .then(function () {
            expect(bowerJson().dependencies).to.eql({});
        });
    });

});
